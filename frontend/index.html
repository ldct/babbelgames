<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.6/react-with-addons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.6/react-dom.js"></script>
<script src="https://code.jquery.com/jquery-2.2.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.11.2/lodash.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/1.0.0/fetch.js"></script>

<body style="margin: 0; background-color: white">
<div id="container"></div>
</body>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78695670-1', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/babel">
var EpisodeTile = React.createClass({
  handleClick: function () {
    console.log(this.props.imgPrefix);
  },
  render: function () {

    var isSelected = !this.props.isPoster && this.props.srcOfMousedOverTile === this.props.src;

    var self = this;
    var tile = <div
      onMouseEnter={function () {
        self.props.onMouseEnter(self.props.src);
      }}
      style={{
        display: 'inline-block',
        width: 182,
        height: 268,
        color: 'black',
        margin: 1,
        position: 'relative',
      }}
      onClick={this.handleClick} >
      <img
        style={{
          opacity: this.props.isPoster ? 1 : (isSelected ? 0.2 : 0.7),
          position: 'absolute',
          top: 0, left: 0,
          width: '100%', height: '100%',
        }}
        src={'/img/' + this.props.src.replace('/', '.') + '.jpg'} />
      <div
        style={{
          visibility: isSelected ? 'visible' : 'hidden',
          fontFamily: 'Georgia,serif',
          position: 'absolute',
          flexDirection: 'column',
          top: 0, left: 0,
          width: '100%', height: '100%',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          textAlign: 'center',
        }}>
        <div style={{maxWidth: '8em'}}>
        {self.props.headline}
        </div>
      </div>
    </div>

    if (this.props.isPoster) {
      return tile;
    } else {
      return <a href={"/screenplayGame.html?src=" + this.props.src + '.srt.json'}>
        {tile}
      </a>
    }

  }
});

var App = React.createClass({
  getInitialState: function () {
    return {
      srcOfMousedOverTile: null,
    }
  },
  handleMouseOverTile: function (src) {
    this.setState({
      srcOfMousedOverTile: src,
    });
  },
  render: function () {
    var mo = this.handleMouseOverTile;
    return <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      flexWrap: 'wrap',
      height: '80%',
    }}>
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="friends.poster" isPoster={true} />
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="friends/s01e01" headline="The One Where Monica Gets a Roommate"/>
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="friends/s01e02" headline="The One With the Sonogram at the End"/>
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="friends/s01e03" headline="The One With the Thumb"/>
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="sherlock.poster" isPoster={true} />
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="sherlock/s01e01" headline="A Study in Pink" />
      <EpisodeTile srcOfMousedOverTile={this.state.srcOfMousedOverTile} onMouseEnter={mo} src="sherlock/s01e02" headline="The Blind Banker" />
    </div>
  }
});

ReactDOM.render(
  <App />,
  document.getElementById('container')
);

</script>
